"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[610],{1841:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"guides/dra","title":"DRA Experiment Execution","description":"The Digital Research Alliance of Canada (aka \\"The Alliance\\") provides High Performance Parallel Compute (HPPC) reseources to Canada\'s research community. This includes servers with many parallel CPUs, GPUs, FPGAs, and more. We primarily use many CPUs.","source":"@site/docs/guides/dra.md","sourceDirName":"guides","slug":"/guides/dra","permalink":"/docs/guides/dra","draft":false,"unlisted":false,"editUrl":"https://github.com/tangledprogramgraphs/docs/tree/main/docs/guides/dra.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"CLI Experiment Execution","permalink":"/docs/guides/experiments"},"next":{"title":"Future Work","permalink":"/docs/future-work"}}');var i=s(4848),c=s(8453);const t={sidebar_position:1},o="DRA Experiment Execution",a={},l=[{value:"Resources",id:"resources",level:3},{value:"Quick Start",id:"quick-start",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"dra-experiment-execution",children:"DRA Experiment Execution"})}),"\n",(0,i.jsx)(n.p,{children:'The Digital Research Alliance of Canada (aka "The Alliance") provides High Performance Parallel Compute (HPPC) reseources to Canada\'s research community. This includes servers with many parallel CPUs, GPUs, FPGAs, and more. We primarily use many CPUs.'}),"\n",(0,i.jsx)(n.h3,{id:"resources",children:"Resources"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://docs.alliancecan.ca/wiki/Technical_documentation",children:"Technical Documentation"})}),"\n",(0,i.jsx)(n.h3,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsxs)(n.p,{children:["Pick a ",(0,i.jsx)(n.a,{href:"https://docs.alliancecan.ca/wiki/National_systems#Compute_clusters",children:"compute cluster"})," to use and login via ssh. We'll use ",(0,i.jsx)(n.a,{href:"https://docs.alliancecan.ca/wiki/Narval",children:"narval"}),". Note you'll need to setup ",(0,i.jsx)(n.a,{href:"https://docs.alliancecan.ca/wiki/Multifactor_authentication",children:"multifactor authentication"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ssh [USERNAME]@narval.alliancecan.ca\n"})}),"\n",(0,i.jsx)(n.p,{children:"Move to ~/projects/def-skelly and create your personal directory."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd ~/projects/def-skelly\nmkdir [USERNAME]\ncd [USERNAME]\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Set up your environment variables to automatically load when you login by adding the following to the end of your ",(0,i.jsx)(n.code,{children:"~/.bash_profile"})," file (replace [USERNAME] with your username):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"export TPG=$HOME/projects/def-skelly/[USERNAME]/tpg\nexport PATH=$PATH:$TPG/scripts/plot\nexport PATH=$PATH:$TPG/scripts/run\nexport MUJOCO=$HOME/projects/def-skelly/[USERNAME]/mujoco-3.2.2\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$MUJOCO/lib/\n\nmodule load \\\n  StdEnv/2023 scipy-stack/2023b python/3.10 \\\n  arrow/15.0.1 gcc/12.3 opencv/4.9.0 cmake/3.27.7 \\\n  eigen/3.4.0 boost-mpi/1.82.0 glfw/3.3.8 tbb/2021.10.0 \\\n  hdf5/1.14.2\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Note that you will need to install ",(0,i.jsx)(n.a,{href:"https://mujoco.org/",children:"mujoco"})," as specified in your ",(0,i.jsx)(n.code,{children:".bash_profile"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["After editing ",(0,i.jsx)(n.code,{children:".bash_profile"}),", run:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"source ~/.bash_profile\n"})}),"\n",(0,i.jsx)(n.p,{children:"Clone this repo and cd to its root directory:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git clone https://gitlab.cas.mcmaster.ca/kellys32/tpg.git\ncd tpg\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tpg/scripts/run/tpg-run-slurm.sh"})," is a generalized ",(0,i.jsx)(n.a,{href:"https://docs.alliancecan.ca/wiki/Running_jobs",children:"job script"}),". Each experiment folder may also have a specialized script. These job scripts set parameters such as how many nodes and cpus you need and which ",(0,i.jsx)(n.a,{href:"https://docs.alliancecan.ca/wiki/Job_scheduling_policies#Time_limits",children:"time limit queue"})," you want to place your job in. In general, shorter jobs that use less resources will run sooner. See ",(0,i.jsx)(n.a,{href:"https://docs.alliancecan.ca/wiki/Job_scheduling_policies",children:"scheduling policies"})," for complete details."]}),"\n",(0,i.jsxs)(n.p,{children:["In our example, each job (experiment repeat) will use 64 cpus and we want them all on the same node, so we use an entire 64-cpu node. The default time limit is 3 hours. Our ",(0,i.jsx)(n.code,{children:"tpg-run-slurm.sh"})," job script looks like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'#!/bin/bash\n#SBATCH --account=def-skelly\n# single node\n#SBATCH --nodes=1\n#SBATCH --ntasks-per-node=64\n#SBATCH --mem=0\n#SBATCH --time=0-3:00  # time (DD-HH:MM)\n\n#defaults\nmode=0 #Train:0, Replay:1, Debug:2\nseed=1\nwhile getopts m:s: flag\ndo\n   case "${flag}" in\n      m) mode=${OPTARG};;\n      s) seed=${OPTARG};;\n   esac\ndone\nif [ $mode -eq 0 ]; then\n  srun ../build/release/cpp/experiments/TPGExperimentMPI -s $seed \\\n  1> tpg.$seed.$$.std 2> tpg.$seed.$$.err\nfi\n'})}),"\n",(0,i.jsx)(n.p,{children:"For each unique experiment, best practice is to copy the experiment directory and append a unique date, time, and git revision like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cp -r mujoco/ mujoco-reacher-`date +%Y-%m-%d-%H-%M-%S`-`git rev-parse --short HEAD`\n"})}),"\n",(0,i.jsx)(n.p,{children:"From inside the newly created experiment directory, we run serveral experiments at once using unique seeds. Here's an example command using a for loop:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"for seed in `seq 1 3`; do sbatch $TPG/scripts/run/tpg-run-slurm.sh -s $seed -p $TPG/configs/<yaml_file>; done\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To ",(0,i.jsx)(n.a,{href:"https://docs.alliancecan.ca/wiki/Running_jobs#Monitoring_jobs",children:"monitor"})," your job use:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"squeue -u [USERNAME]\n"})}),"\n",(0,i.jsx)(n.p,{children:"To cancel a job:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"scancel <jobid>\n"})}),"\n",(0,i.jsx)(n.p,{children:"To cancel all your running jobs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"scancel -u [USERNAME]\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Copying data from clusters to you local computer"})}),"\n",(0,i.jsxs)(n.p,{children:["You can use ",(0,i.jsx)(n.code,{children:"scp"})," to copy data from the cluster to you local computer. Here's an example command to run locally:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"scp -r skelly@narval.alliancecan.ca:/home/skelly/projects/def-skelly/skelly/tpg/experiment_directories/mujoco-reacher-2024-11-27-07-57-05-b997160 ./\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"-r"})," flag indicates you want to copy the directory and all its contents recursively."]}),"\n",(0,i.jsxs)(n.p,{children:["Note that you can also transfer data using other ssh clients such as ",(0,i.jsx)(n.a,{href:"https://filezilla-project.org/",children:"FileZilla"})," or ",(0,i.jsx)(n.a,{href:"https://docs.alliancecan.ca/wiki/Multifactor_authentication#WinSCP",children:"WinSCP"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var r=s(6540);const i={},c=r.createContext(i);function t(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);